<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>System Komunikacji Roblox ↔ HTML</title>
<style>
body { 
    font-family: 'Segoe UI', system-ui, sans-serif; 
    background: #000000; 
    color: #ffffff; 
    margin: 0; 
    padding: 0; 
}

h1 { 
    text-align: center; 
    padding: 24px; 
    color: #ffffff; 
    margin: 0; 
    font-weight: 600;
    border-bottom: 1px solid #333333;
    background: #0a0a0a;
}

#servers { 
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 20px; 
    padding: 24px; 
    max-width: 1400px;
    margin: 0 auto;
}

@media (max-width: 1000px) {
    #servers {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 600px) {
    #servers {
        grid-template-columns: 1fr;
        padding: 16px;
    }
}

.server { 
    background: #1a1a1a; 
    border-radius: 16px; 
    padding: 20px; 
    border: 1px solid #333333;
    transition: transform 0.2s ease, border-color 0.2s ease;
}

.server:hover { 
    transform: translateY(-4px); 
    border-color: #444444;
}

.server h3 { 
    margin: 0 0 12px 0; 
    color: #ffffff;
    font-size: 1.25rem;
    font-weight: 600;
}

.instance { 
    font-size: 0.9em; 
    color: #aaaaaa;
    margin: 0 0 16px 0;
    font-family: 'Consolas', monospace;
}

.server ul { 
    list-style: none; 
    padding: 0; 
    margin: 0 0 20px 0;
}

.server li { 
    display: flex; 
    align-items: center; 
    padding: 12px 0;
    border-bottom: 1px solid #333333;
}

.server li:last-child {
    border-bottom: none;
}

.server li img { 
    border-radius: 50%; 
    margin-right: 12px; 
    width: 48px; 
    height: 48px; 
    object-fit: cover;
    border: 2px solid #333333;
}

.playtime { 
    margin-left: auto; 
    color: #aaaaaa; 
    font-size: 0.9em;
    font-weight: 500;
}

button { 
    margin-top: 12px; 
    padding: 10px 20px; 
    border: none; 
    border-radius: 10px; 
    background: #8b0000; 
    color: white; 
    cursor: pointer; 
    transition: background 0.2s ease;
    font-weight: 500;
    width: 100%;
    font-size: 0.95rem;
    opacity: 0.6;
}

button:hover { 
    background: #660000;
}
</style>
</head>
<body>

<h1>System Komunikacji Roblox ↔ HTML</h1>
<div id="servers"></div>

<script>
const API_KEY = "SECRET_KEY_123";
const BACKEND_URL = "https://backrobloxserver.fly.dev";

async function loadServers() {
  try {
    const res = await fetch(BACKEND_URL + "/servers");
    const servers = await res.json();
    const container = document.getElementById("servers");
    container.innerHTML = "";

    for (const server of servers) {
      const div = document.createElement("div");
      div.className = "server";

      const title = document.createElement("h3");
      title.textContent = `Graczy: ${server.playerCount}`;
      div.appendChild(title);

      const instance = document.createElement("div");
      instance.className = "instance";
      instance.textContent = `ID: ${server.instanceId}`;
      div.appendChild(instance);

      const ul = document.createElement("ul");
      server.players.sort((a, b) => b.playtime - a.playtime);

      for (const p of server.players) {
        const li = document.createElement("li");
        const img = document.createElement("img");
        img.src = p.avatar;
        li.appendChild(img);

        li.appendChild(document.createTextNode(p.name));

        const time = document.createElement("span");
        time.className = "playtime";
        time.textContent = `${Math.floor(p.playtime / 60)} min`;
        li.appendChild(time);

        ul.appendChild(li);
      }

      div.appendChild(ul);

      const btn = document.createElement("button");
      btn.textContent = "Shutdown (Nie działa narazie)";
      btn.onclick = async () => {
        const reason = prompt("Powód shutdown:", "Konserwacja serwera");
        if (reason) {
          try {
            await fetch(BACKEND_URL + "/shutdown", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ 
                serverId: server.instanceId, 
                reason, 
                apiKey: API_KEY 
              })
            });
            alert("Komenda shutdown wysłana!");
          } catch (error) {
            alert("Funkcja shutdown jest obecnie niedostępna");
          }
        }
      };
      div.appendChild(btn);

      container.appendChild(div);
    }

  } catch (e) { 
    console.error("Błąd ładowania serwerów:", e);
  }
}

loadServers();
setInterval(loadServers, 5000);
</script>

</body>
</html>
